<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AlphaEdu - Registrar</title>
  <link rel="stylesheet" href="css/styleRegistrar.css">
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- ================================================== -->
  <!-- CSS PARA A NOVA TELA DE SUCESSO (Adicionado ) -->
  <!-- ================================================== -->
  <style>
    /* Esconde a mensagem de sucesso por padrão */
    #successContainer {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px;
      animation: fadeIn 0.5s ease-in-out;
    }

    /* Ícone de check verde */
    .success-icon {
      width: 80px;
      height: 80px;
      color: #226ec5; /* Verde vibrante */
      margin-bottom: 24px;
    }

    /* Título da mensagem */
    #successContainer h2 {
      font-size: 28px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 12px;
    }

    /* Parágrafo da mensagem */
    #successContainer p {
      font-size: 16px;
      color: #6b7280;
      max-width: 350px;
      line-height: 1.6;
      margin-bottom: 32px;
    }

    /* Botão para ir ao painel */
    #successContainer a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 32px;
      background-color: #2563eb; /* Azul padrão do seu projeto */
      color: white;
      text-decoration: none;
      border-radius: 999px; /* Botão "pílula" */
      font-weight: 600;
      font-size: 16px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 14px rgba(37, 99, 235, 0.25);
    }

    #successContainer a:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
    }

    /* Animação de Fade In */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="left"></div>
  <div class="right">
    <div class="form-container">
      
      <!-- Container do Formulário de Registro (some ao ter sucesso) -->
      <div id="registrationContainer">
        <div class="tab-container">
          <div class="tab active" data-target="inscrever">Inscrever-se</div>
          <div class="tab" data-target="entrar">Entrar</div>
          <div class="underline"></div>
        </div>
        <form id="registerForm">
          <div class="form-group"><label for="username">Nome de usuário</label><input type="text" id="username" required /></div>
          <div class="form-group"><label for="email">E-mail</label><input type="email" id="email" placeholder="Insira seu endereço de e-mail" required /></div>
          <div class="form-group"><label for="user-type">Tipo de Usuário</label><select id="user-type" required><option value="" disabled selected>Selecione</option><option value="aluno">Aluno</option><option value="professor">Professor</option></select></div>
          <div class="form-group"><label for="senha">Senha</label><input type="password" id="senha" required /></div>
          <div class="form-group"><label for="confirmar-senha">Confirmar Senha</label><input type="password" id="confirmar-senha" required /></div>
          <button type="submit" class="submit-btn">Inscrever-se</button>
        </form>
        <div class="bottom">Já possui uma conta? <a href="Login.html">Entre</a></div>
      </div>

      <!-- ================================================== -->
      <!-- NOVA TELA DE SUCESSO (Aparece após o cadastro) -->
      <!-- ================================================== -->
      <div id="successContainer">
        <i data-lucide="check-circle" class="success-icon"></i>
        <h2>Conta Criada!</h2>
        <p>Seja bem-vindo(a) ao AlphaEdu! Seu espaço de estudos está pronto para ser explorado.</p>
        <a id="redirectLink" href="PainelAluno.html">
          Ir para o Painel
          <i data-lucide="arrow-right"></i>
        </a>
      </div>

    </div>
  </div>

<script type="module">
  // ==================================================
  // SCRIPT DO FIREBASE (Lógica permanece a mesma)
  // ==================================================
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBdXV5FGtIgGulzCoOGO7humceFOmA5KVU",
    authDomain: "alphaedu-1a738.firebaseapp.com",
    databaseURL: "https://alphaedu-1a738-default-rtdb.firebaseio.com/",
    projectId: "alphaedu-1a738",
    storageBucket: "alphaedu-1a738.firebasestorage.app",
    messagingSenderId: "570881564591",
    appId: "1:570881564591:web:60c1ed6f8aaa414b27995a",
    measurementId: "G-M36B97ZQVY"
  };
  const app = initializeApp(firebaseConfig );
  const auth = getAuth(app);
  const db = getDatabase(app);

  const registerForm = document.getElementById("registerForm");
  const submitButton = document.querySelector(".submit-btn");
  const registrationContainer = document.getElementById("registrationContainer");
  const successContainer = document.getElementById("successContainer");
  const successRedirectLink = document.querySelector("#successContainer a");

  // Função para mostrar o modal de erro (reutilizada)
  function showModal(title, message) {
      // Se você tiver um modal de erro, pode chamá-lo aqui.
      // Por enquanto, usaremos o alert.
      alert(`${title}\n\n${message}`);
  }

  registerForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    submitButton.disabled = true;
    submitButton.textContent = "Aguarde...";

    const username = document.getElementById("username").value;
    const email = document.getElementById("email").value;
    const userType = document.getElementById("user-type").value;
    const password = document.getElementById("senha").value;
    const confirmPassword = document.getElementById("confirmar-senha").value;

    if (password !== confirmPassword) {
      showModal("Erro de Senha", "As senhas não coincidem.");
      submitButton.disabled = false;
      submitButton.textContent = "Inscrever-se";
      return;
    }

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      await set(ref(db, 'users/' + user.uid), {
        uid: user.uid,
        username: username,
        email: email,
        userType: userType,
        createdAt: new Date().toISOString()
      });

      // Esconde o formulário e mostra a mensagem de sucesso
      registrationContainer.style.display = "none";
      successContainer.style.display = "flex";

      const redirectLink = document.getElementById("redirectLink");
      if (userType === 'professor') {
        redirectLink.href = 'telaProfessor.html';
        redirectLink.innerHTML = 'Ir para o Painel do Professor <i data-lucide="arrow-right"></i>';
      } else {
        redirectLink.innerHTML = 'Ir para o Painel <i data-lucide="arrow-right"></i>';
      }

      lucide.createIcons(); // Recria os ícones para a tela de sucesso

    } catch (error) {
      console.error("Ocorreu um erro:", error.code, error.message);
      submitButton.disabled = false;
      submitButton.textContent = "Inscrever-se";

      if (error.code === 'auth/email-already-in-use') {
        showModal("Erro de Cadastro", "Este e-mail já está em uso. Tente fazer login ou use um e-mail diferente.");
      } else if (error.code === 'auth/weak-password') {
        showModal("Senha Fraca", "A senha é muito fraca. Tente uma senha mais forte com pelo menos 6 caracteres.");
      } else {
        showModal("Erro Inesperado", "Ocorreu um erro ao criar sua conta. Tente novamente.");
      }
    }
  });
</script>

<script type="module" src="js/scriptRegistrar.js"></script>
 
</body>
</html>

